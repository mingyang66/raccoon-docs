##### Redis的KeyExpirationEventMessageListener键过期监听器

> MessageListener通过监听key过期的Redis keyspace通知，然后通过ApplicationEventPublisher发布RedisKeyExpiredEvent事件的模式进行事件监听和广播。

###### 一、开启Redis键空间

配置发布哪些类型的键空间通知，允许客户端订阅PUB/SUB频道：

1. 通过修改redis.conf配置文件；
2. 通过应用程序命令行参数模式；

```sh
notify-keyspace-events Ex
```

notify-keyspace-events选项用于配置Keyspace Notifications，即当Redis数据集发生变化时，它可以发布事件。该选项枚举值由多个字符组成，如下：

- K：Keyspace事件，当某个键的事件发生时发布。
- E：Keyevent事件，当某个键的事件发生时发布，但事件类型与Keyspace事件不同。如：键的创建、删除、过期等相关操作（set、del、expired、evicted）。
- g：通用命令（如：DEL、EXPIRE等）触发的事件。
- $：String命令触发的事件。
- l：List命令触发的事件。
- s：Set命令触发的事件。
- h：Hash命令触发的时间。
- z：Zset(Sorted Set)命令触发的事件。
- x：过期时间（每当key过期时生成）。
- e：驱逐时间（当key由于maxmemory策略而被驱逐时生成）。
- A：g$lshzxe的别名，表示所有事件。

注意：

1. K和E的主要区别在于它们发布的事件的详细信息不同。
2. 你可以组合这些字符来指定你感兴趣的事件类型和数据类型。
3. 默认情况下，这个选项是关闭的（即没有设置）。

###### 二、应用程序或命令行通道定义

- 键空间：

```sh
__keyspace@<db>__:<pattern>
```

- 键事件

```sh
__keyevent@<db>__:<event>
```

> 如：过期时间通道\__keyevent@*__:expired